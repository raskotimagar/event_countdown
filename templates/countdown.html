{% extends 'base.html' %}

{% block title %}Countdown - {{ event.name }}{% endblock %}

{% block content %}
<body class="text-light flex items-center justify-center min-h-screen p-4">
    <div class="countdown-box w-full max-w-3xl">
        <div class="countdown-content p-8">
            <!-- Event Title -->
            <div class="text-center mb-10">
                <h1 class="text-4xl md:text-5xl font-bold mb-2 bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">
                    {{ event.name }}
                </h1>
                {% if event.description %}
                <p class="text-slate-400">{{ event.description }}</p>
                {% else %}
                <p class="text-slate-400">Get ready for something amazing!</p>
                {% endif %}
            </div>
            
            <!-- Countdown Timer -->
            <div class="flex justify-center mb-12">
                <div class="grid grid-cols-4 gap-4 md:gap-6 w-full max-w-2xl">
                    <!-- Days -->
                    <div class="flex flex-col items-center">
                        <div class="countdown-digit bg-slate-800 rounded-xl w-full py-6 flex items-center justify-center">
                            <span class="text-4xl md:text-6xl font-bold" id="days">00</span>
                        </div>
                        <span class="text-slate-400 mt-2 text-sm">Days</span>
                    </div>
                    
                    <!-- Hours -->
                    <div class="flex flex-col items-center">
                        <div class="countdown-digit bg-slate-800 rounded-xl w-full py-6 flex items-center justify-center">
                            <span class="text-4xl md:text-6xl font-bold" id="hours">00</span>
                        </div>
                        <span class="text-slate-400 mt-2 text-sm">Hours</span>
                    </div>
                    
                    <!-- Minutes -->
                    <div class="flex flex-col items-center">
                        <div class="countdown-digit bg-slate-800 rounded-xl w-full py-6 flex items-center justify-center">
                            <span class="text-4xl md:text-6xl font-bold" id="minutes">00</span>
                        </div>
                        <span class="text-slate-400 mt-2 text-sm">Minutes</span>
                    </div>
                    
                    <!-- Seconds -->
                    <div class="flex flex-col items-center">
                        <div class="countdown-digit bg-slate-800 rounded-xl w-full py-6 flex items-center justify-center">
                            <span class="text-4xl md:text-6xl font-bold" id="seconds">00</span>
                        </div>
                        <span class="text-slate-400 mt-2 text-sm">Seconds</span>
                    </div>
                </div>
            </div>
            
            <!-- Event Date -->
            <div class="text-center mb-10">
                <p class="text-lg text-slate-300">
                    <i class="far fa-calendar-alt mr-2"></i>
                    Event Date: 
                    <span class="font-semibold" id="event-date">{{ event.event_date}}</span>
                </p>
            </div>
            
            <!-- Expired Message -->
            <div id="expired-message" class="hidden">
                <div class="bg-red-900/30 border border-red-500 rounded-xl p-6 text-center">
                    <h2 class="text-3xl font-bold text-red-400 mb-2">
                        <i class="fas fa-exclamation-circle mr-2"></i>Event Expired!
                    </h2>
                    <p class="text-slate-300">This event has already occurred.</p>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-wrap justify-center gap-4 mt-10">
                <a href="{% url 'update_event' event.id %}" class="px-6 py-3 bg-primary hover:bg-blue-500 rounded-lg font-medium transition flex items-center">
                    <i class="fas fa-edit mr-2"></i> Edit Event
                </a>
                <a href="{% url 'delete_event' event.id %}" class="px-6 py-3 bg-red-600 hover:bg-red-700 rounded-lg font-medium transition flex items-center">
                    <i class="fas fa-trash mr-2"></i> Delete
                </a>
                <a href="{% url 'event_list' %}" class="px-6 py-3 bg-secondary hover:bg-violet-700 rounded-lg font-medium transition flex items-center">
                    <i class="fas fa-calendar-alt mr-2"></i> View All Events
                </a>
            </div>
        </div>
    </div>
    
    <script>
        // Function to update the countdown
        function updateCountdown() {
            fetch("{% url 'countdown_data' event.id %}")
                .then(response => response.json())
                .then(data => {
                    const totalSeconds = data.total_seconds;
                    const countdownElement = document.getElementById('countdown-timer');
                    const expiredMessage = document.getElementById('expired-message');
                    
                    if (data.expired) {
                        // Hide the countdown grid
                        document.querySelector('.grid').classList.add('hidden');
                        // Show expired message
                        expiredMessage.classList.remove('hidden');
                        return;
                    }
                    
                    // Calculate time units
                    const days = Math.floor(totalSeconds / (3600 * 24));
                    const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = Math.floor(totalSeconds % 60);
                    
                    // Update display
                    document.getElementById('days').textContent = days.toString().padStart(2, '0');
                    document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                    document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                    document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                    
                    // Add flip animation to seconds
                    document.getElementById('seconds').parentElement.classList.add('flip');
                    setTimeout(() => {
                        document.getElementById('seconds').parentElement.classList.remove('flip');
                    }, 500);
                });
        }
        
        // Initial update
        updateCountdown();
        
        // Update every second
        setInterval(updateCountdown, 1000);
    </script>
</body>
{% endblock %}